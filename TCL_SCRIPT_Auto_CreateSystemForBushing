# Create system for Bushing
*clearmarkall 1; *clearmarkall 2;
*createmarkpanel elem 1 "select Bushing elem";

set bushing_id [hm_getmark elem 1];



set comp_name [hm_getvalue elem id=$bushing_id dataname=collector.name];

puts "Bushing comp name: $comp_name";

set ref_name [split $comp_name ""];

set checkName [lrange $ref_name 0 2];
set checkName [join $checkName ""];

if {1} {
	if {$checkName == "EKE"} {
		set ref_name "OR_LOCAL";
	} else {
		set ref_name [lrange $ref_name 4 end];

		set ref_name [join $ref_name ""];
	}
}



puts "Reference name: $ref_name";


# CREATE NODE SET FOR EACH BUSHING ELEMENT
if {1} {
	*createmark node 1 "by elem id" $bushing_id;
	set bushingNodeIds [hm_getmark nodes 1]
	set nodeSetName [join [list $ref_name "NSET"] "_"];
	
	# CHECK THE EXISTANCE OF NODE SET
		if {1} {
			# 
				if {[hm_entityinfo exist sets $nodeSetName -byname]} {
					*createmark sets 1 $nodeSetName
					*deletemark sets 1;
					*entitysetcreate $nodeSetName nodes 1;
				} else {
					*entitysetcreate $nodeSetName nodes 1;
				}
				
			*createmark sets 1 "by name" $nodeSetName;
			set nodeSetId [hm_getmark sets 1];
		}
	
;
}

# CREATE SYSTEM collector
if {1} {
	set systName [join [list $ref_name "SYST"] "_"];
	# CHECK THE EXISTANCE OF SYSTEM COLLECTOR
		if {1} {
			# 
				if {[hm_entityinfo exist systcols $systName -byname]} {
					*createmark systcols 1 $systName
					*deletemark systcols 1;
					*createentity systcols name=$systName;
				} else {
					*createentity systcols name=$systName;
				}
		}
}

# CREATE SYSTEM FOR CREATED SYS COLECTOR, ASSIGN NODE SET AND EDIT IT.
if {1} {
	# GET 1 NODE FOR PLANE
	if {1} {
		
		*createmark nodes 1 [lindex $bushingNodeIds 0];
		*duplicatemark nodes 1 28
		*createmark nodes 1 [hm_entitymaxid node 0];
		
		set planeNode [hm_getmark node 1];
		
		*createvector 1 1 1 0
		*translatemark nodes 1 1 100
	}
	# CREATE SYSTEM
	if {1} {
		*createmark nodes 1 [lindex $bushingNodeIds 0];
		*systemcreate 1 0 [lindex $bushingNodeIds 0] "z-axis" [lindex $bushingNodeIds 1] "yz plane    " $planeNode;
		# GET SYS ID;
		
		*createmark syst 1 "by systcols name" $systName;
		set systId [hm_getmark syst 1];
		puts "systId : $systId";
	}
	# ASSIGN NSET TO SYSTEM
	if {0} {
		*createmark systems 1 $systId
		*attributeupdateintmark systems 1 2514 2 0 1 $nodeSetId;
	}
	# CARD EDIT
	if {1} {
		# TURN ON TRANSFORM
			*createmark systems 1 $systId
			*attributeupdateintmark systems 1 2 2 2 0 1;
		# TURN ON ORIENTATION
			*createmark systems 1 $systId
			*attributeupdateintmark systems 1 4015 2 2 0 1;
		# SET ORIENTATION NAME
			*createmark systems 1 $systId
			*attributeupdatestringmark systems 1 3066 2 2 1 $nodeSetName;
		
	}
	
	
}

*clearmarkall 1; *clearmarkall 2;





