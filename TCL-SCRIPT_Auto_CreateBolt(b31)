*createmark elem 1 "by comp name" "HM_MPC_BEAM";

set rigidId [hm_getmark elem 1];

set nodeId {};

foreach id $rigidId {
	lappend nodeId [hm_getvalue elem id=$id dataname=node1];
}

*elementtype 61 13; #CONN3D2

if {1} {
	# CREATE A TEMPORARY COMPONENTS
		if {[hm_entityinfo exist comp PB_BOLT_B31 -byname]} {
			*currentcollector components "PB_BOLT_B31";
		} else {
			*createentity comps name=PB_BOLT_B31;
			}
		}
set tolerance1 10; #SET TOLERENCE AND MODIFY
set tolerence2 30;
		
foreach node $nodeId {
	foreach node2 $nodeId {
		if {$node == $node2} {
			continue;
		} else {
			set a [hm_getdistance node $node $node2 0];

			if {[lindex $a 0] <$tolerance1} {
				*rod $node $node2 "";
				break;
			} elseif  {[lindex $a 0] <$tolerence2} {
				# CHECK WHETHER 2 RIGID ELEM IN THE SAME COMP OR NOT
				if {1} {
					set index1 [lsearch $nodeId $node]; # Index for node
					set index2 [lsearch $nodeId $node2]; # Index for node2
					
					# GET COMP ID ATTACHED TO 2 ELEMS;
						*createmark elem 1 [lindex $rigidId $index1];
						*findmark elem 1 1 1 elem 0 2;
						set tempElemId [hm_getmark elem 2];
						set compIdFirst [hm_getvalue elem id=[lindex $tempElemId 0] dataname=collector.id];
						
						*createmark elem 1 [lindex $rigidId $index2];
						*findmark elem 1 1 1 elem 0 2;
						set tempElemId [hm_getmark elem 2];
						set compIdSecond [hm_getvalue elem id=[lindex $tempElemId 0] dataname=collector.id];
						
				}
					
				# CREATE ROD
					if {$compIdFirst==$compIdSecond} {
						if {[lindex $a 0] <40} {
							*rod $node $node2 "";
							break;
						}
					} else {
					
					*rod $node $node2 "";
					break;
					}
			} else {continue;}
		}
	}
}


# CHECK DUPLICATE AND DELETE
		if {1} {
			*createmark elements 1 "all"
			*createmark elements 2
			*elementtestduplicates elements 1 2 1
			if {[hm_marklength elem 2] != 0} {
				*deletemark elem 2;
			}

		}

# SET CONFIG AND EDIT
 if {1} {
	*elementtype 60 9
	*createmark elem 1 "by comp name" PB_BOLT_B31;
	*configedit 1 "bar2"
 }
